
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="../_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="../_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>DEP (Device Enrollment Program) &#8212; commandment 1.0 documentation</title>
    <link rel="stylesheet" href="../_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer Documentation" href="../developer/index.html" />
    <link rel="prev" title="Configuration" href="configuration.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../developer/index.html" title="Developer Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">commandment 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar">
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Contents</h2>
    <div class="sidebar-localtoc">
      <ul>
<li><a class="reference internal" href="#">DEP (Device Enrollment Program)</a><ul>
<li><a class="reference internal" href="#configuring-via-the-ui">Configuring via the UI</a></li>
<li><a class="reference internal" href="#configuring-via-api">Configuring via API</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
</div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="configuration.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../developer/index.html"
                        title="next chapter">Developer Documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/dep.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="../index.html">Docs</a></li>
              
              <li>DEP (Device Enrollment Program)</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="dep-device-enrollment-program">
<h1>DEP (Device Enrollment Program)<a class="headerlink" href="#dep-device-enrollment-program" title="Permalink to this headline">¶</a></h1>
<p>This document outlines configuration of the DEP device syncing service.
This information applies to classic DEP as well as Apple School Manager and Apple Business Manager.</p>
<div class="section" id="configuring-via-the-ui">
<h2>Configuring via the UI<a class="headerlink" href="#configuring-via-the-ui" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Click on <strong>Settings</strong> -&gt; <strong>DEP Accounts</strong>.</li>
<li><strong>New DEP Account</strong></li>
<li>Click on the <strong>Download</strong> button to begin downloading a Public Key.
You will use this to upload to Apple Business Manager <a class="footnote-reference" href="#abm" id="id1">[1]</a> or Apple School Manager <a class="footnote-reference" href="#asm" id="id2">[2]</a>.</li>
<li>Create a new <strong>MDM Server</strong> in ASM or ABM, as described in the ASM Help <a class="reference external" href="https://help.apple.com/schoolmanager/#/asm1c1be359d">here</a>.</li>
<li>Upload the <code class="file docutils literal notranslate"><span class="pre">commandment-dep.cer</span></code> file you just downloaded, using the <strong>Upload Key</strong> button.</li>
</ul>
<div class="figure align-right">
<img alt="../_images/upload-key.png" src="../_images/upload-key.png" />
</div>
<ul class="simple">
<li>Download the DEP token using the <strong>Get Token</strong> link.</li>
<li>Unfortunately, for now you will have to upload the token using the <strong>curl</strong> command as outlined in API step 5.</li>
</ul>
</div>
<div class="section" id="configuring-via-api">
<h2>Configuring via API<a class="headerlink" href="#configuring-via-api" title="Permalink to this headline">¶</a></h2>
<ol class="arabic">
<li><p class="first">Make a <em>GET</em> request to <code class="docutils literal notranslate"><span class="pre">/dep/certificate/download</span></code> to download the initial DEP Public Key. The public key is
generated on request, and stored in the database with name <code class="docutils literal notranslate"><span class="pre">COMMANDMENT-DEP</span></code>.</p>
</li>
<li><p class="first">Perform the manual process of Adding an ASM/ABM <strong>MDM Server</strong>, and uploading the certificate you retrieved in step 1.</p>
</li>
<li><p class="first">Download the DEP token from ASM/ABM, which will be a file ending in <code class="docutils literal notranslate"><span class="pre">_smime.p7m</span></code>.</p>
</li>
<li><p class="first">Upload the file to <code class="docutils literal notranslate"><span class="pre">/dep/stoken/upload</span></code> as multipart/form-encoded with the file field of <strong>file</strong>, the equivalent
curl command line would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">F</span> <span class="s1">&#39;file=@/path/to/_smime.p7m&#39;</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">commandment</span><span class="o">.</span><span class="n">local</span><span class="o">/</span><span class="n">dep</span><span class="o">/</span><span class="n">stoken</span><span class="o">/</span><span class="n">upload</span>
</pre></div>
</div>
</li>
<li><p class="first">The DEP token should be decrypted, and devices should start appearing when the next DEP sync happens or when the
server is restarted. For convenience, the decrypted token is provided in the result of this request as a json payload,
structured like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;access_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;AS_1234&quot;</span><span class="p">,</span>
  <span class="s2">&quot;access_token&quot;</span><span class="p">:</span> <span class="s2">&quot;AT_1234&quot;</span><span class="p">,</span>
  <span class="s2">&quot;access_token_expiry&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-10-02T00:00:00Z&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consumer_key&quot;</span><span class="p">:</span> <span class="s2">&quot;CK_1234&quot;</span><span class="p">,</span>
  <span class="s2">&quot;consumer_secret&quot;</span><span class="p">:</span> <span class="s2">&quot;CS_1234&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="abm" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Apple Business Manager</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="asm" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Apple School Manager, available at <a class="reference external" href="https://school.apple.com">https://school.apple.com</a></td></tr>
</tbody>
</table>
</div>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="configuration.html" title="previous chapter (use the left arrow)">Configuration</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="../developer/index.html" title="next chapter (use the right arrow)">Developer Documentation</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../http-routingtable.html" title="HTTP Routing Table"
             >routing table</a> |</li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../developer/index.html" title="Developer Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="configuration.html" title="Configuration"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">commandment 1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="../_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2017, Jesse Peterson, Mosen. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>